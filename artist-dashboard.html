<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„í‹°ìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ - UTOPIA X</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/chat.css">
    <style>
        /* [í•µì‹¬] CSS ì›ì²œ ì°¨ë‹¨ - ê¶Œí•œ í™•ì¸ ì „ê¹Œì§€ í™”ë©´ ìˆ¨ê¹€ */
        body {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        body.loaded {
            visibility: visible;
            opacity: 1;
        }
        
        /* Global Loading Overlay */
        #globalLoadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            visibility: visible;
            opacity: 1;
        }
        
        #globalLoadingOverlay.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(157, 78, 221, 0.2);
            border-top-color: #9d4edd;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            color: white;
            font-size: 18px;
            font-weight: 500;
        }
        
        /* Hide dashboard content until loaded */
        body.loading .dashboard-container,
        body.loading nav {
            display: none !important;
        }
        
        .dashboard-container {
            max-width: 1200px;
            margin: 100px auto 60px;
            padding: 0 20px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .dashboard-title h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .dashboard-title p {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(157, 78, 221, 0.2);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }
        
        .stat-icon.profile {
            background: linear-gradient(135deg, #E91E84, #9D4EDD);
            color: white;
        }
        
        .stat-icon.requests {
            background: linear-gradient(135deg, #6366F1, #3B82F6);
            color: white;
        }
        
        .stat-icon.projects {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .dashboard-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
        }
        
        .profile-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .profile-item {
            padding: 16px;
            background: rgba(157, 78, 221, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
        }
        
        .profile-item-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .profile-item-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .status-badge.active {
            background: rgba(16, 185, 129, 0.1);
            color: #10B981;
        }
        
        .status-badge.pending {
            background: rgba(251, 191, 36, 0.1);
            color: #F59E0B;
        }
        
        .status-badge.inactive {
            background: rgba(239, 68, 68, 0.1);
            color: #EF4444;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .empty-state p {
            font-size: 16px;
        }
        
        .request-list {
            display: grid;
            gap: 16px;
        }
        
        .request-item {
            padding: 20px;
            background: rgba(157, 78, 221, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .request-item:hover {
            background: rgba(157, 78, 221, 0.1);
            border-color: var(--primary-purple);
        }
        
        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .request-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .request-date {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .request-details {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        
        .request-actions {
            display: flex;
            gap: 12px;
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .profile-summary {
                grid-template-columns: 1fr;
            }
            
            .request-header {
                flex-direction: column;
                gap: 8px;
            }
            
            .request-actions {
                flex-direction: column;
            }
        }
    </style>
    
    <!-- Supabase JS Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Supabase Initialization -->
    <script>
        const SUPABASE_URL = 'https://idfpmynjfkvtcsqcjgnm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlkZnBteW5qZmt2dGNzcWNqZ25tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NzQ2NTgsImV4cCI6MjA4NTI1MDY1OH0.KFmClnG-XuW818uUIMlPW0yQ7UswXvIWh-ipv6z5p4I';
        if (typeof supabase !== 'undefined') {
            window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log("âœ… Supabase Connected!");
        }
    </script>
    
    <!-- Dashboard Loader (MUST load first) -->
    <script src="js/dashboard-loader.js"></script>
</head>
<body class="loading">
    <!-- Global Loading Overlay -->
    <div id="globalLoadingOverlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <a href="index.html" class="logo">
                    <img src="https://www.genspark.ai/api/files/s/qeJgU55W" alt="UTOPIA X">
                </a>
                <ul class="nav-links">
                    <li><a href="index.html">í™ˆ</a></li>
                    <li><a href="#" class="active">ëŒ€ì‹œë³´ë“œ</a></li>
                </ul>
                <div class="user-menu">
                    <button class="user-menu-btn" id="userMenuBtn">
                        <i class="fas fa-user-circle"></i>
                        <span class="user-email" id="userEmailDisplay">Loading...</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="user-menu-dropdown" id="userMenuDropdown">
                        <div class="user-menu-items">
                            <button class="user-menu-item" id="btnMyProfile">
                                <i class="fas fa-user"></i>
                                ë‚´ í”„ë¡œí•„ ìˆ˜ì •
                            </button>
                            <button class="user-menu-item" id="btnMyRequests">
                                <i class="fas fa-inbox"></i>
                                ë°›ì€ ì„­ì™¸ ìš”ì²­
                            </button>
                            <button class="user-menu-item" id="btnSettings">
                                <i class="fas fa-cog"></i>
                                ì„¤ì •
                            </button>
                        </div>
                        <div class="user-menu-divider"></div>
                        <button class="user-menu-item logout-btn" id="btnLogout">
                            <i class="fas fa-sign-out-alt"></i>
                            ë¡œê·¸ì•„ì›ƒ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <h1>ì•„í‹°ìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ</h1>
                <p id="welcomeMessage">í™˜ì˜í•©ë‹ˆë‹¤! í”„ë¡œí•„ì„ ê´€ë¦¬í•˜ì„¸ìš”.</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="openChatListModal()" class="btn btn-gradient" style="position: relative;">
                    <i class="fas fa-comments"></i>
                    ğŸ’¬ ë©”ì‹œì§€í•¨
                    <span id="chatUnreadBadge" class="badge-notification" style="display: none;">0</span>
                </button>
                <button class="btn btn-gradient" id="btnEditProfile">
                    <i class="fas fa-edit"></i>
                    í”„ë¡œí•„ ìˆ˜ì •
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon profile">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stat-value">
                    <span class="status-badge pending" id="profileStatus">ì‹¬ì‚¬ ëŒ€ê¸°ì¤‘</span>
                </div>
                <div class="stat-label">í”„ë¡œí•„ ìƒíƒœ</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon requests">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="stat-value" id="statRequests">0</div>
                <div class="stat-label">ë°›ì€ ì„­ì™¸ ìš”ì²­</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon projects">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-value" id="statCompleted">0</div>
                <div class="stat-label">ì™„ë£Œí•œ í”„ë¡œì íŠ¸</div>
            </div>
        </div>

        <!-- Profile Summary -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-id-card"></i>
                    ë‚´ í”„ë¡œí•„ ìš”ì•½
                </h2>
                <button class="btn btn-sm btn-outline" id="btnViewPublicProfile">
                    <i class="fas fa-eye"></i>
                    ê³µê°œ í”„ë¡œí•„ ë³´ê¸°
                </button>
            </div>
            <div class="profile-summary">
                <div class="profile-item">
                    <div class="profile-item-label">ì „ë¬¸ ì¥ë¥´</div>
                    <div class="profile-item-value" id="profileGenre">ë¯¸ë“±ë¡</div>
                </div>
                <div class="profile-item">
                    <div class="profile-item-label">í™œë™ ì§€ì—­</div>
                    <div class="profile-item-value" id="profileRegion">ë¯¸ë“±ë¡</div>
                </div>
                <div class="profile-item">
                    <div class="profile-item-label">ì„­ì™¸ íšŸìˆ˜</div>
                    <div class="profile-item-value" id="profileHireCount">0íšŒ</div>
                </div>
                <div class="profile-item">
                    <div class="profile-item-label">í‰ê·  í‰ì </div>
                    <div class="profile-item-value" id="profileRating">
                        <i class="fas fa-star" style="color: #F59E0B;"></i> 0.0
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Requests -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-inbox"></i>
                    ìµœê·¼ ì„­ì™¸ ìš”ì²­
                </h2>
            </div>
            <div class="request-list" id="requestList">
                <!-- Empty state -->
                <div class="empty-state">
                    <i class="fas fa-inbox"></i>
                    <p>ì•„ì§ ë°›ì€ ì„­ì™¸ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p style="margin-top: 10px; font-size: 14px;">í”„ë¡œí•„ì„ ì™„ì„±í•˜ê³  ìŠ¹ì¸ë°›ìœ¼ë©´ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì„­ì™¸ ìš”ì²­ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Authentication System -->
    <script src="js/supabase-config.js"></script>
    <script src="js/supabase-auth.js"></script>
    
    <!-- Dashboard Script -->
    <script>
        // Check authentication
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ­ Loading artist dashboard...');
            
            // Check if user is logged in
            const userEmail = sessionStorage.getItem('userEmail');
            const userRole = sessionStorage.getItem('userRole');
            
            if (!userEmail) {
                console.log('âš ï¸ No user logged in, redirecting to home');
                showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤', 'info');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
                return;
            }
            
            // Check if user is artist
            if (userRole !== 'artist') {
                console.log('âš ï¸ User is not an artist, redirecting...');
                showToast('ì•„í‹°ìŠ¤íŠ¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
                setTimeout(() => {
                    if (userRole === 'client') {
                        window.location.href = 'client-dashboard.html';
                    } else {
                        window.location.href = 'index.html';
                    }
                }, 1000);
                return;
            }
            
            // Update UI with user data
            const userEmailDisplay = document.getElementById('userEmailDisplay');
            const welcomeMessage = document.getElementById('welcomeMessage');
            
            if (userEmailDisplay) {
                userEmailDisplay.textContent = userEmail;
            }
            
            if (welcomeMessage) {
                welcomeMessage.textContent = `í™˜ì˜í•©ë‹ˆë‹¤, ${userEmail}!`;
            }
            
            // Load user data
            loadDashboardData();
            
            // Initialize event listeners
            initDashboardEvents();
            
            console.log('âœ… Dashboard loaded');
        });
        
        // Load dashboard data
        function loadDashboardData() {
            // Mock data for now
            const mockProfile = {
                status: 'pending', // pending, active, inactive
                genre: 'í™í•©, ì¼€ì´íŒ',
                region: 'ì„œìš¸',
                hireCount: 0,
                rating: 0.0,
                requests: 0,
                completed: 0
            };
            
            // Update profile status
            const profileStatus = document.getElementById('profileStatus');
            if (profileStatus) {
                const statusMap = {
                    'pending': 'ì‹¬ì‚¬ ëŒ€ê¸°ì¤‘',
                    'active': 'í™œì„±',
                    'inactive': 'ë¹„í™œì„±'
                };
                profileStatus.textContent = statusMap[mockProfile.status] || 'ë¯¸ë“±ë¡';
                profileStatus.className = `status-badge ${mockProfile.status}`;
            }
            
            // Update stats
            document.getElementById('statRequests').textContent = mockProfile.requests;
            document.getElementById('statCompleted').textContent = mockProfile.completed;
            
            // Update profile summary
            document.getElementById('profileGenre').textContent = mockProfile.genre || 'ë¯¸ë“±ë¡';
            document.getElementById('profileRegion').textContent = mockProfile.region || 'ë¯¸ë“±ë¡';
            document.getElementById('profileHireCount').textContent = `${mockProfile.hireCount}íšŒ`;
            document.getElementById('profileRating').innerHTML = `<i class="fas fa-star" style="color: #F59E0B;"></i> ${mockProfile.rating.toFixed(1)}`;
            
            // Load requests
            loadRequests();
        }
        
        // Load requests
        function loadRequests() {
            const requestList = document.getElementById('requestList');
            
            // Mock requests (empty for now)
            const mockRequests = [];
            
            if (mockRequests.length === 0) {
                // Show empty state (already in HTML)
                return;
            }
            
            // Clear empty state and render requests
            requestList.innerHTML = '';
            
            mockRequests.forEach(request => {
                const requestItem = document.createElement('div');
                requestItem.className = 'request-item';
                requestItem.innerHTML = `
                    <div class="request-header">
                        <div>
                            <div class="request-title">${request.title}</div>
                            <div class="request-date">${request.date}</div>
                        </div>
                        <span class="status-badge ${request.status}">${request.statusText}</span>
                    </div>
                    <div class="request-details">${request.details}</div>
                    <div class="request-actions">
                        <button class="btn btn-sm btn-gradient">ìƒì„¸ ë³´ê¸°</button>
                        <button class="btn btn-sm btn-outline">ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>
                    </div>
                `;
                requestList.appendChild(requestItem);
            });
        }
        
        // Initialize dashboard events
        function initDashboardEvents() {
            // Logout button
            const logoutBtn = document.getElementById('btnLogout');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    console.log('ğŸ‘‹ Logging out...');
                    
                    // Sign out
                    if (typeof signOut === 'function') {
                        await signOut();
                    } else {
                        // Fallback
                        sessionStorage.clear();
                        showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                        window.location.href = 'index.html';
                    }
                });
            }
            
            // User menu toggle
            const userMenuBtn = document.getElementById('userMenuBtn');
            const userMenuDropdown = document.getElementById('userMenuDropdown');
            
            if (userMenuBtn && userMenuDropdown) {
                userMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    userMenuDropdown.classList.toggle('active');
                });
                
                // Close on outside click
                document.addEventListener('click', () => {
                    userMenuDropdown.classList.remove('active');
                });
            }
            
            // Edit profile button
            const btnEditProfile = document.getElementById('btnEditProfile');
            if (btnEditProfile) {
                btnEditProfile.addEventListener('click', () => {
                    showToast('í”„ë¡œí•„ ìˆ˜ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
                });
            }
            
            // View public profile button
            const btnViewPublicProfile = document.getElementById('btnViewPublicProfile');
            if (btnViewPublicProfile) {
                btnViewPublicProfile.addEventListener('click', () => {
                    showToast('ê³µê°œ í”„ë¡œí•„ ë³´ê¸° ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤', 'info');
                });
            }
        }
        
        // Toast notification function
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            if (toast) {
                toast.textContent = message;
                toast.className = `toast ${type} show`;
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            } else {
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
        }
    </script>
    
    <!-- Chat Module -->
    <script src="js/chat.js"></script>
    
    <!-- Chat Modals -->
    <div id="chatListModal" class="modal" style="display: none;">
        <div class="modal-content modal-md">
            <button class="modal-close" onclick="closeChatListModal()">&times;</button>
            <div class="modal-header">
                <h2><i class="fas fa-comments"></i> ë©”ì‹œì§€ ëª©ë¡</h2>
                <p>í´ë¼ì´ì–¸íŠ¸ë“¤ê³¼ì˜ ëŒ€í™” ë‚´ì—­</p>
            </div>
            <div id="chatListContainer" class="chat-list-container">
                <p class="text-center text-muted">ì±„íŒ… ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>
    </div>
    
    <div id="chatModal" class="modal" style="display: none;">
        <div class="modal-content modal-md chat-modal">
            <div class="chat-header">
                <button class="modal-close" onclick="ChatModule.closeChatModal()">&times;</button>
                <div class="chat-partner-info">
                    <i class="fas fa-user-circle" style="font-size: 24px; margin-right: 10px;"></i>
                    <div>
                        <h3 id="chatPartnerName">ìƒëŒ€ë°©</h3>
                        <span class="chat-status" id="chatStatus">
                            <i class="fas fa-circle"></i> ì˜¨ë¼ì¸
                        </span>
                    </div>
                </div>
            </div>
            
            <div id="chatMessages" class="chat-messages">
                <!-- Messages will be rendered here -->
            </div>
            
            <div class="chat-input-container">
                <input 
                    type="text" 
                    id="chatInput" 
                    class="chat-input" 
                    placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                    onkeypress="if(event.key === 'Enter') sendChatMessage()"
                >
                <button class="btn-send" onclick="sendChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Chat Functions -->
    <script>
        async function openChatListModal() {
            console.log('ğŸ’¬ Opening chat list...');
            
            const modal = document.getElementById('chatListModal');
            if (modal) {
                modal.style.display = 'flex';
            }
            
            await loadChatList();
        }
        
        function closeChatListModal() {
            const modal = document.getElementById('chatListModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }
        
        async function loadChatList() {
            const container = document.getElementById('chatListContainer');
            if (!container) return;
            
            container.innerHTML = '<p class="text-center text-muted">ì±„íŒ… ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
            
            if (!ChatModule.currentUserId) {
                const success = await ChatModule.init();
                if (!success) {
                    container.innerHTML = '<p class="text-center text-danger">ì±„íŒ… ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
            }
            
            await ChatModule.loadConversations();
            
            if (ChatModule.state.conversations.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comments" style="font-size: 64px; color: var(--text-muted); margin-bottom: 20px;"></i>
                        <p class="text-muted">ì•„ì§ ì±„íŒ… ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p class="text-muted" style="font-size: 14px;">í´ë¼ì´ì–¸íŠ¸ì˜ ë¬¸ì˜ë¥¼ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = ChatModule.state.conversations.map(conv => `
                <div class="chat-list-item" onclick="openChatWithPartner('${conv.partnerId}')">
                    <div class="chat-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="chat-info">
                        <div class="chat-name">Partner ID: ${conv.partnerId.substring(0, 8)}...</div>
                        <div class="chat-preview">${conv.lastMessage}</div>
                    </div>
                    <div class="chat-meta">
                        <div class="chat-time">${ChatModule.formatTime(conv.lastMessageTime)}</div>
                        ${conv.unreadCount > 0 ? `<span class="badge-notification">${conv.unreadCount}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        async function openChatWithPartner(partnerId) {
            console.log('ğŸ’¬ Opening chat with:', partnerId);
            closeChatListModal();
            await ChatModule.openChatWith(partnerId, 'Partner', null);
        }
        
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            if (!input) return;
            
            const message = input.value.trim();
            if (!message) return;
            
            console.log('ğŸ“¤ Sending message:', message);
            
            const result = await ChatModule.sendMessage(
                ChatModule.state.currentChatPartnerId,
                message
            );
            
            if (result.success) {
                input.value = '';
                ChatModule.renderNewMessage(result.data);
            } else {
                showToast('ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨', 'error');
            }
        }
    </script>
    
    <!-- Dashboard Common Scripts -->
    <script src="js/dashboard-common.js"></script>
</body>
</html>
